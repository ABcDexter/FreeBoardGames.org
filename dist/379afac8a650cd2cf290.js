(this["webpackJsonp"] = this["webpackJsonp"] || []).push([[7],{

/***/ "./src/games/checkers/game.ts":
/*!************************************!*\
  !*** ./src/games/checkers/game.ts ***!
  \************************************/
/*! exports provided: INITIAL_BOARD, sumCoords, multiplyCoord, inBounds, toCoord, toIndex, areCoordsEqual, checkPosition, getValidMoves, move, CheckersGame */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "INITIAL_BOARD", function() { return INITIAL_BOARD; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "sumCoords", function() { return sumCoords; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "multiplyCoord", function() { return multiplyCoord; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "inBounds", function() { return inBounds; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "toCoord", function() { return toCoord; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "toIndex", function() { return toIndex; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "areCoordsEqual", function() { return areCoordsEqual; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "checkPosition", function() { return checkPosition; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getValidMoves", function() { return getValidMoves; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "move", function() { return move; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CheckersGame", function() { return CheckersGame; });
/* harmony import */ var _freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @freeboardgame.org/boardgame.io/core */ "./node_modules/@freeboardgame.org/boardgame.io/core.js");
/* harmony import */ var _freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__);
function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance"); }

function _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }



var piece = function piece(id, player) {
  return {
    id: id,
    playerID: player.toString(),
    isKing: false
  };
};

var INITIAL_BOARD = [null, piece(0, 1), null, piece(1, 1), null, piece(2, 1), null, piece(3, 1), piece(4, 1), null, piece(5, 1), null, piece(6, 1), null, piece(7, 1), null, null, piece(8, 1), null, piece(9, 1), null, piece(10, 1), null, piece(11, 1), null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, piece(12, 0), null, piece(13, 0), null, piece(14, 0), null, piece(15, 0), null, null, piece(16, 0), null, piece(17, 0), null, piece(18, 0), null, piece(19, 0), piece(20, 0), null, piece(21, 0), null, piece(22, 0), null, piece(23, 0), null];
var MAN_DIRS = [[{
  x: -1,
  y: -1
}, {
  x: 1,
  y: -1
}], [{
  x: -1,
  y: 1
}, {
  x: 1,
  y: 1
}]];
var KING_DIRS = [{
  x: -1,
  y: 1
}, {
  x: 1,
  y: 1
}, {
  x: -1,
  y: -1
}, {
  x: 1,
  y: -1
}];
function sumCoords(a, b) {
  return {
    x: a.x + b.x,
    y: a.y + b.y
  };
}
function multiplyCoord(coord, multiplier) {
  return {
    x: coord.x * multiplier,
    y: coord.y * multiplier
  };
}
function inBounds(coord) {
  return coord.x >= 0 && coord.x < 8 && coord.y >= 0 && coord.y < 8;
}
function toCoord(position) {
  var x = position % 8;
  var y = Math.floor(position / 8);
  return {
    x: x,
    y: y
  };
}
function toIndex(coord) {
  return coord.x + coord.y * 8;
}
function areCoordsEqual(a, b) {
  return a.x === b.x && a.y === b.y;
}
function checkPosition(G, playerID, piece, coord) {
  var dirs = piece.isKing ? KING_DIRS : MAN_DIRS[playerID];
  var moves = [];
  var jumped = false;
  var _iteratorNormalCompletion = true;
  var _didIteratorError = false;
  var _iteratorError = undefined;

  try {
    for (var _iterator = dirs[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
      var dir = _step.value;
      // Look into all valid directions
      var opponentBefore = null;

      for (var i = 1; piece.isKing ? true : i < 3; i++) {
        var final = sumCoords(coord, multiplyCoord(dir, i)); // Break if move is out of bounds

        if (!inBounds(final)) {
          break;
        }

        var moveTo = G.board[toIndex(final)]; // Break if we encounter our piece

        if (moveTo !== null && moveTo.playerID === playerID) {
          break;
        }

        if (moveTo !== null && moveTo.playerID !== playerID) {
          // If we already encountered opponent the directions is blocked
          if (opponentBefore) {
            break;
          }

          opponentBefore = final;
        }

        if (moveTo === null) {
          moves.push({
            from: coord,
            to: final,
            jumped: opponentBefore
          });

          if (opponentBefore) {
            jumped = true;
            break;
          } // If there is nothing and the piece isn't king there is no need to continue


          if (!piece.isKing) {
            break;
          }
        }
      }
    }
  } catch (err) {
    _didIteratorError = true;
    _iteratorError = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion && _iterator.return != null) {
        _iterator.return();
      }
    } finally {
      if (_didIteratorError) {
        throw _iteratorError;
      }
    }
  }

  return {
    moves: moves,
    jumped: jumped
  };
}
function getValidMoves(G, playerID, jumping) {
  var movesTotal = [];
  var jumpedTotal = false;

  if (typeof jumping === 'undefined') {
    G.board.forEach(function (piece, index) {
      if (piece !== null && piece.playerID === playerID) {
        var _movesTotal;

        var coord = toCoord(index);

        var _checkPosition = checkPosition(G, playerID, piece, coord),
            moves = _checkPosition.moves,
            jumped = _checkPosition.jumped;

        (_movesTotal = movesTotal).push.apply(_movesTotal, _toConsumableArray(moves));

        jumpedTotal = jumpedTotal || jumped;
      }
    });
  } else {
    var _checkPosition2 = checkPosition(G, playerID, jumping.data, jumping.coord),
        moves = _checkPosition2.moves,
        jumped = _checkPosition2.jumped;

    movesTotal = moves;
    jumpedTotal = jumped;
  }

  if (jumpedTotal) {
    return movesTotal.filter(function (move) {
      return move.jumped;
    });
  } else {
    return movesTotal;
  }
}
function move(G, ctx, from, to) {
  var indexFrom = toIndex(from);
  var indexTo = toIndex(to);
  var piece = G.board[indexFrom];
  var crownhead = ctx.playerID === '0' ? 0 : 7;

  if (piece === null || piece.playerID !== ctx.playerID || G.board[indexTo] !== null) {
    return _freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__["INVALID_MOVE"];
  }

  var moves = G.jumping === null ? getValidMoves(G, ctx.playerID) : getValidMoves(G, ctx.playerID, G.jumping);
  var move = moves.find(function (move) {
    return areCoordsEqual(move.from, from) && areCoordsEqual(move.to, to);
  });

  if (typeof move === 'undefined') {
    return _freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__["INVALID_MOVE"];
  }

  var jumped = move.jumped !== null ? toIndex(move.jumped) : -1;
  var isKing = piece.isKing || to.y === crownhead;
  var newG = Object.assign({}, G, {
    board: G.board.map(function (square, i) {
      switch (i) {
        case indexFrom:
          return null;

        case indexTo:
          return Object.assign({}, piece, {
            isKing: isKing
          });

        case jumped:
          return null;

        default:
          return square;
      }
    }),
    jumping: null
  });

  if (move.jumped === null) {
    return newG;
  }

  var jumping = {
    data: Object.assign({}, piece, {
      isKing: isKing
    }),
    coord: to
  };
  var postMoves = getValidMoves(newG, ctx.playerID, jumping);

  if (postMoves.length > 0 && postMoves[0].jumped !== null) {
    return Object.assign({}, newG, {
      jumping: jumping
    });
  }

  return newG;
}
var CheckersGame = Object(_freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__["Game"])({
  name: 'checkers',
  setup: function setup() {
    return {
      board: INITIAL_BOARD,
      jumping: null
    };
  },
  moves: {
    move: move
  },
  flow: {
    movesPerTurn: 1,
    turnOrder: {
      first: function first() {
        return 0;
      },
      next: function next(G, ctx) {
        return G.jumping === null ? (ctx.playOrderPos + 1) % ctx.numPlayers : ctx.playOrderPos;
      }
    },
    endGameIf: function endGameIf(G, ctx) {
      if (getValidMoves(G, ctx.currentPlayer === '0' ? '1' : '0').length === 0) {
        return {
          winner: ctx.currentPlayer
        };
      }
    }
  }
});

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZXMvY2hlY2tlcnMvZ2FtZS50cyJdLCJuYW1lcyI6WyJwaWVjZSIsImlkIiwicGxheWVyIiwicGxheWVySUQiLCJ0b1N0cmluZyIsImlzS2luZyIsIklOSVRJQUxfQk9BUkQiLCJNQU5fRElSUyIsIngiLCJ5IiwiS0lOR19ESVJTIiwic3VtQ29vcmRzIiwiYSIsImIiLCJtdWx0aXBseUNvb3JkIiwiY29vcmQiLCJtdWx0aXBsaWVyIiwiaW5Cb3VuZHMiLCJ0b0Nvb3JkIiwicG9zaXRpb24iLCJNYXRoIiwiZmxvb3IiLCJ0b0luZGV4IiwiYXJlQ29vcmRzRXF1YWwiLCJjaGVja1Bvc2l0aW9uIiwiRyIsImRpcnMiLCJtb3ZlcyIsImp1bXBlZCIsImRpciIsIm9wcG9uZW50QmVmb3JlIiwiaSIsImZpbmFsIiwibW92ZVRvIiwiYm9hcmQiLCJwdXNoIiwiZnJvbSIsInRvIiwiZ2V0VmFsaWRNb3ZlcyIsImp1bXBpbmciLCJtb3Zlc1RvdGFsIiwianVtcGVkVG90YWwiLCJmb3JFYWNoIiwiaW5kZXgiLCJkYXRhIiwiZmlsdGVyIiwibW92ZSIsImN0eCIsImluZGV4RnJvbSIsImluZGV4VG8iLCJjcm93bmhlYWQiLCJJTlZBTElEX01PVkUiLCJmaW5kIiwibmV3RyIsIk9iamVjdCIsImFzc2lnbiIsIm1hcCIsInNxdWFyZSIsInBvc3RNb3ZlcyIsImxlbmd0aCIsIkNoZWNrZXJzR2FtZSIsIkdhbWUiLCJuYW1lIiwic2V0dXAiLCJmbG93IiwibW92ZXNQZXJUdXJuIiwidHVybk9yZGVyIiwiZmlyc3QiLCJuZXh0IiwicGxheU9yZGVyUG9zIiwibnVtUGxheWVycyIsImVuZEdhbWVJZiIsImN1cnJlbnRQbGF5ZXIiLCJ3aW5uZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0EsSUFBTUEsS0FBSyxHQUFHLFNBQVJBLEtBQVEsQ0FBQ0MsRUFBRCxFQUFLQyxNQUFMO0FBQUEs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LENBQXpCLEMiLCJmaWxlIjoiMzc5YWZhYzhhNjUwY2QyY2YyOTAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHYW1lLCBJTlZBTElEX01PVkUgfSBmcm9tICdAZnJlZWJvYXJkZ2FtZS5vcmcvYm9hcmRnYW1lLmlvL2NvcmUnO1xuY29uc3QgcGllY2UgPSAoaWQsIHBsYXllcikgPT4gKHsgaWQsIHBsYXllcklEOiBwbGF5ZXIudG9TdHJpbmcoKSwgaXNLaW5nOiBmYWxzZSB9KTtcbmV4cG9ydCBjb25zdCBJTklUSUFMX0JPQVJEID0gW1xuICAgIG51bGwsXG4gICAgcGllY2UoMCwgMSksXG4gICAgbnVsbCxcbiAgICBwaWVjZSgxLCAxKSxcbiAgICBudWxsLFxuICAgIHBpZWNlKDIsIDEpLFxuICAgIG51bGwsXG4gICAgcGllY2UoMywgMSksXG4gICAgcGllY2UoNCwgMSksXG4gICAgbnVsbCxcbiAgICBwaWVjZSg1LCAxKSxcbiAgICBudWxsLFxuICAgIHBpZWNlKDYsIDEpLFxuICAgIG51bGwsXG4gICAgcGllY2UoNywgMSksXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIHBpZWNlKDgsIDEpLFxuICAgIG51bGwsXG4gICAgcGllY2UoOSwgMSksXG4gICAgbnVsbCxcbiAgICBwaWVjZSgxMCwgMSksXG4gICAgbnVsbCxcbiAgICBwaWVjZSgxMSwgMSksXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIG51bGwsXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIG51bGwsXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIG51bGwsXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIG51bGwsXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIG51bGwsXG4gICAgbnVsbCxcbiAgICBwaWVjZSgxMiwgMCksXG4gICAgbnVsbCxcbiAgICBwaWVjZSgxMywgMCksXG4gICAgbnVsbCxcbiAgICBwaWVjZSgxNCwgMCksXG4gICAgbnVsbCxcbiAgICBwaWVjZSgxNSwgMCksXG4gICAgbnVsbCxcbiAgICBudWxsLFxuICAgIHBpZWNlKDE2LCAwKSxcbiAgICBudWxsLFxuICAgIHBpZWNlKDE3LCAwKSxcbiAgICBudWxsLFxuICAgIHBpZWNlKDE4LCAwKSxcbiAgICBudWxsLFxuICAgIHBpZWNlKDE5LCAwKSxcbiAgICBwaWVjZSgyMCwgMCksXG4gICAgbnVsbCxcbiAgICBwaWVjZSgyMSwgMCksXG4gICAgbnVsbCxcbiAgICBwaWVjZSgyMiwgMCksXG4gICAgbnVsbCxcbiAgICBwaWVjZSgyMywgMCksXG4gICAgbnVsbCxcbl07XG5jb25zdCBNQU5fRElSUyA9IFtbeyB4OiAtMSwgeTogLTEgfSwgeyB4OiAxLCB5OiAtMSB9XSwgW3sgeDogLTEsIHk6IDEgfSwgeyB4OiAxLCB5OiAxIH1dXTtcbmNvbnN0IEtJTkdfRElSUyA9IFt7IHg6IC0xLCB5OiAxIH0sIHsgeDogMSwgeTogMSB9LCB7IHg6IC0xLCB5OiAtMSB9LCB7IHg6IDEsIHk6IC0xIH1dO1xuZXhwb3J0IGZ1bmN0aW9uIHN1bUNvb3JkcyhhLCBiKSB7XG4gICAgcmV0dXJuIHsgeDogYS54ICsgYi54LCB5OiBhLnkgKyBiLnkgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBtdWx0aXBseUNvb3JkKGNvb3JkLCBtdWx0aXBsaWVyKSB7XG4gICAgcmV0dXJuIHsgeDogY29vcmQueCAqIG11bHRpcGxpZXIsIHk6IGNvb3JkLnkgKiBtdWx0aXBsaWVyIH07XG59XG5leHBvcnQgZnVuY3Rpb24gaW5Cb3VuZHMoY29vcmQpIHtcbiAgICByZXR1cm4gY29vcmQueCA+PSAwICYmIGNvb3JkLnggPCA4ICYmIGNvb3JkLnkgPj0gMCAmJiBjb29yZC55IDwgODtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0Nvb3JkKHBvc2l0aW9uKSB7XG4gICAgY29uc3QgeCA9IHBvc2l0aW9uICUgODtcbiAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihwb3NpdGlvbiAvIDgpO1xuICAgIHJldHVybiB7IHgsIHkgfTtcbn1cbmV4cG9ydCBmdW5jdGlvbiB0b0luZGV4KGNvb3JkKSB7XG4gICAgcmV0dXJuIGNvb3JkLnggKyBjb29yZC55ICogODtcbn1cbmV4cG9ydCBmdW5jdGlvbiBhcmVDb29yZHNFcXVhbChhLCBiKSB7XG4gICAgcmV0dXJuIGEueCA9PT0gYi54ICYmIGEueSA9PT0gYi55O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrUG9zaXRpb24oRywgcGxheWVySUQsIHBpZWNlLCBjb29yZCkge1xuICAgIGNvbnN0IGRpcnMgPSBwaWVjZS5pc0tpbmcgPyBLSU5HX0RJUlMgOiBNQU5fRElSU1twbGF5ZXJJRF07XG4gICAgbGV0IG1vdmVzID0gW107XG4gICAgbGV0IGp1bXBlZCA9IGZhbHNlO1xuICAgIGZvciAoY29uc3QgZGlyIG9mIGRpcnMpIHtcbiAgICAgICAgLy8gTG9vayBpbnRvIGFsbCB2YWxpZCBkaXJlY3Rpb25zXG4gICAgICAgIGxldCBvcHBvbmVudEJlZm9yZSA9IG51bGw7XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBwaWVjZS5pc0tpbmcgPyB0cnVlIDogaSA8IDM7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgZmluYWwgPSBzdW1Db29yZHMoY29vcmQsIG11bHRpcGx5Q29vcmQoZGlyLCBpKSk7XG4gICAgICAgICAgICAvLyBCcmVhayBpZiBtb3ZlIGlzIG91dCBvZiBib3VuZHNcbiAgICAgICAgICAgIGlmICghaW5Cb3VuZHMoZmluYWwpKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBtb3ZlVG8gPSBHLmJvYXJkW3RvSW5kZXgoZmluYWwpXTtcbiAgICAgICAgICAgIC8vIEJyZWFrIGlmIHdlIGVuY291bnRlciBvdXIgcGllY2VcbiAgICAgICAgICAgIGlmIChtb3ZlVG8gIT09IG51bGwgJiYgbW92ZVRvLnBsYXllcklEID09PSBwbGF5ZXJJRCkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1vdmVUbyAhPT0gbnVsbCAmJiBtb3ZlVG8ucGxheWVySUQgIT09IHBsYXllcklEKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBlbmNvdW50ZXJlZCBvcHBvbmVudCB0aGUgZGlyZWN0aW9ucyBpcyBibG9ja2VkXG4gICAgICAgICAgICAgICAgaWYgKG9wcG9uZW50QmVmb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvcHBvbmVudEJlZm9yZSA9IGZpbmFsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1vdmVUbyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG1vdmVzLnB1c2goeyBmcm9tOiBjb29yZCwgdG86IGZpbmFsLCBqdW1wZWQ6IG9wcG9uZW50QmVmb3JlIH0pO1xuICAgICAgICAgICAgICAgIGlmIChvcHBvbmVudEJlZm9yZSkge1xuICAgICAgICAgICAgICAgICAgICBqdW1wZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm90aGluZyBhbmQgdGhlIHBpZWNlIGlzbid0IGtpbmcgdGhlcmUgaXMgbm8gbmVlZCB0byBjb250aW51ZVxuICAgICAgICAgICAgICAgIGlmICghcGllY2UuaXNLaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4geyBtb3ZlcywganVtcGVkIH07XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0VmFsaWRNb3ZlcyhHLCBwbGF5ZXJJRCwganVtcGluZykge1xuICAgIGxldCBtb3Zlc1RvdGFsID0gW107XG4gICAgbGV0IGp1bXBlZFRvdGFsID0gZmFsc2U7XG4gICAgaWYgKHR5cGVvZiBqdW1waW5nID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICBHLmJvYXJkLmZvckVhY2goKHBpZWNlLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKHBpZWNlICE9PSBudWxsICYmIHBpZWNlLnBsYXllcklEID09PSBwbGF5ZXJJRCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvb3JkID0gdG9Db29yZChpbmRleCk7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBtb3ZlcywganVtcGVkIH0gPSBjaGVja1Bvc2l0aW9uKEcsIHBsYXllcklELCBwaWVjZSwgY29vcmQpO1xuICAgICAgICAgICAgICAgIG1vdmVzVG90YWwucHVzaCguLi5tb3Zlcyk7XG4gICAgICAgICAgICAgICAganVtcGVkVG90YWwgPSBqdW1wZWRUb3RhbCB8fCBqdW1wZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgeyBtb3ZlcywganVtcGVkIH0gPSBjaGVja1Bvc2l0aW9uKEcsIHBsYXllcklELCBqdW1waW5nLmRhdGEsIGp1bXBpbmcuY29vcmQpO1xuICAgICAgICBtb3Zlc1RvdGFsID0gbW92ZXM7XG4gICAgICAgIGp1bXBlZFRvdGFsID0ganVtcGVkO1xuICAgIH1cbiAgICBpZiAoanVtcGVkVG90YWwpIHtcbiAgICAgICAgcmV0dXJuIG1vdmVzVG90YWwuZmlsdGVyKG1vdmUgPT4gbW92ZS5qdW1wZWQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG1vdmVzVG90YWw7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIG1vdmUoRywgY3R4LCBmcm9tLCB0bykge1xuICAgIGNvbnN0IGluZGV4RnJvbSA9IHRvSW5kZXgoZnJvbSk7XG4gICAgY29uc3QgaW5kZXhUbyA9IHRvSW5kZXgodG8pO1xuICAgIGNvbnN0IHBpZWNlID0gRy5ib2FyZFtpbmRleEZyb21dO1xuICAgIGNvbnN0IGNyb3duaGVhZCA9IGN0eC5wbGF5ZXJJRCA9PT0gJzAnID8gMCA6IDc7XG4gICAgaWYgKHBpZWNlID09PSBudWxsIHx8IHBpZWNlLnBsYXllcklEICE9PSBjdHgucGxheWVySUQgfHwgRy5ib2FyZFtpbmRleFRvXSAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gSU5WQUxJRF9NT1ZFO1xuICAgIH1cbiAgICBjb25zdCBtb3ZlcyA9IEcuanVtcGluZyA9PT0gbnVsbCA/IGdldFZhbGlkTW92ZXMoRywgY3R4LnBsYXllcklEKSA6IGdldFZhbGlkTW92ZXMoRywgY3R4LnBsYXllcklELCBHLmp1bXBpbmcpO1xuICAgIGNvbnN0IG1vdmUgPSBtb3Zlcy5maW5kKG1vdmUgPT4gYXJlQ29vcmRzRXF1YWwobW92ZS5mcm9tLCBmcm9tKSAmJiBhcmVDb29yZHNFcXVhbChtb3ZlLnRvLCB0bykpO1xuICAgIGlmICh0eXBlb2YgbW92ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIElOVkFMSURfTU9WRTtcbiAgICB9XG4gICAgY29uc3QganVtcGVkID0gbW92ZS5qdW1wZWQgIT09IG51bGwgPyB0b0luZGV4KG1vdmUuanVtcGVkKSA6IC0xO1xuICAgIGNvbnN0IGlzS2luZyA9IHBpZWNlLmlzS2luZyB8fCB0by55ID09PSBjcm93bmhlYWQ7XG4gICAgY29uc3QgbmV3RyA9IE9iamVjdC5hc3NpZ24oe30sIEcsIHsgYm9hcmQ6IEcuYm9hcmQubWFwKChzcXVhcmUsIGkpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoaSkge1xuICAgICAgICAgICAgICAgIGNhc2UgaW5kZXhGcm9tOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICBjYXNlIGluZGV4VG86XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBwaWVjZSwgeyBpc0tpbmcgfSk7XG4gICAgICAgICAgICAgICAgY2FzZSBqdW1wZWQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzcXVhcmU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLCBqdW1waW5nOiBudWxsIH0pO1xuICAgIGlmIChtb3ZlLmp1bXBlZCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbmV3RztcbiAgICB9XG4gICAgY29uc3QganVtcGluZyA9IHtcbiAgICAgICAgZGF0YTogT2JqZWN0LmFzc2lnbih7fSwgcGllY2UsIHsgaXNLaW5nIH0pLFxuICAgICAgICBjb29yZDogdG8sXG4gICAgfTtcbiAgICBjb25zdCBwb3N0TW92ZXMgPSBnZXRWYWxpZE1vdmVzKG5ld0csIGN0eC5wbGF5ZXJJRCwganVtcGluZyk7XG4gICAgaWYgKHBvc3RNb3Zlcy5sZW5ndGggPiAwICYmIHBvc3RNb3Zlc1swXS5qdW1wZWQgIT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIG5ld0csIHsganVtcGluZyB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld0c7XG59XG5leHBvcnQgY29uc3QgQ2hlY2tlcnNHYW1lID0gR2FtZSh7XG4gICAgbmFtZTogJ2NoZWNrZXJzJyxcbiAgICBzZXR1cDogKCkgPT4gKHsgYm9hcmQ6IElOSVRJQUxfQk9BUkQsIGp1bXBpbmc6IG51bGwgfSksXG4gICAgbW92ZXM6IHtcbiAgICAgICAgbW92ZSxcbiAgICB9LFxuICAgIGZsb3c6IHtcbiAgICAgICAgbW92ZXNQZXJUdXJuOiAxLFxuICAgICAgICB0dXJuT3JkZXI6IHtcbiAgICAgICAgICAgIGZpcnN0OiAoKSA9PiAwLFxuICAgICAgICAgICAgbmV4dDogKEcsIGN0eCkgPT4gKEcuanVtcGluZyA9PT0gbnVsbCA/IChjdHgucGxheU9yZGVyUG9zICsgMSkgJSBjdHgubnVtUGxheWVycyA6IGN0eC5wbGF5T3JkZXJQb3MpLFxuICAgICAgICB9LFxuICAgICAgICBlbmRHYW1lSWY6IChHLCBjdHgpID0+IHtcbiAgICAgICAgICAgIGlmIChnZXRWYWxpZE1vdmVzKEcsIGN0eC5jdXJyZW50UGxheWVyID09PSAnMCcgPyAnMScgOiAnMCcpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHdpbm5lcjogY3R4LmN1cnJlbnRQbGF5ZXIgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICB9LFxufSk7XG4iXSwic291cmNlUm9vdCI6IiJ9