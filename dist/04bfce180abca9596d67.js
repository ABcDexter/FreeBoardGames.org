(this["webpackJsonp"] = this["webpackJsonp"] || []).push([[8],{

/***/ "./src/games/reversi/game.ts":
/*!***********************************!*\
  !*** ./src/games/reversi/game.ts ***!
  \***********************************/
/*! exports provided: getValidMoves, placePiece, getScoreBoard, ReversiGame */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getValidMoves", function() { return getValidMoves; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "placePiece", function() { return placePiece; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getScoreBoard", function() { return getScoreBoard; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ReversiGame", function() { return ReversiGame; });
/* harmony import */ var _freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @freeboardgame.org/boardgame.io/core */ "./node_modules/@freeboardgame.org/boardgame.io/core.js");
/* harmony import */ var _freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__);
function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }



function toPosition(x, y) {
  return y * 8 + x;
}

function inBounds(x, y) {
  return x >= 0 && x < 8 && y >= 0 && y < 8;
}

function getValidMoves(G, playerID) {
  var validMoves = new Set();
  G.points.map(function (player, position) {
    return {
      player: player,
      position: position
    };
  }).filter(function (point) {
    return point.player === playerID;
  }).forEach(function (point) {
    for (var i = -1; i <= 1; i++) {
      for (var j = -1; j <= 1; j++) {
        if (i === 0 && j === 0) {
          continue;
        }

        var x = point.position % 8;
        var y = Math.floor(point.position / 8);
        var currX = x + i;
        var currY = y + j;
        var k = 1;
        var end = null;

        while (inBounds(currX, currY) && G.points[toPosition(currX, currY)] !== playerID) {
          var position = toPosition(currX, currY);

          if (G.points[position] === null) {
            end = position;
            break;
          }

          k++;
          currX = x + i * k;
          currY = y + j * k;
        }

        if (end !== null && k > 1) {
          validMoves.add(end);
        }
      }
    }
  });

  if (validMoves.size > 0) {
    return validMoves;
  }

  G.points.map(function (player, position) {
    return {
      player: player,
      position: position
    };
  }).filter(function (point) {
    return point.player === null;
  }).forEach(function (point) {
    for (var i = -1; i <= 1; i++) {
      for (var j = -1; j <= 1; j++) {
        if (i === 0 && j === 0) {
          continue;
        }

        var x = point.position % 8;
        var y = Math.floor(point.position / 8);

        if (inBounds(x + i, y + j) && G.points[toPosition(x + i, y + j)] !== null) {
          validMoves.add(point.position);
        }
      }
    }
  });
  return validMoves;
}
function placePiece(G, ctx, x, y) {
  if (G.points[toPosition(x, y)] !== null) {
    return _freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__["INVALID_MOVE"];
  }

  var changed = [toPosition(x, y)]; // Changed positions

  for (var i = -1; i <= 1; i++) {
    for (var j = -1; j <= 1; j++) {
      if (i === 0 && j === 0) {
        continue;
      }

      var valid = false;
      var update = [];
      var currX = x + i;
      var currY = y + j;

      for (var k = 2; inBounds(currX, currY) && G.points[toPosition(currX, currY)] !== null; k++) {
        if (G.points[toPosition(currX, currY)] === ctx.currentPlayer) {
          valid = true;
          break;
        }

        update.push(toPosition(currX, currY));
        currX = x + i * k;
        currY = y + j * k;
      }

      if (valid) {
        changed.push.apply(changed, update);
      }
    }
  }

  if (changed.length === 1) {
    if (getValidMoves(G, ctx.playerID).has(toPosition(x, y))) {
      return Object.assign({}, G, {
        points: Object.values(Object.assign({}, G.points, _defineProperty({}, toPosition(x, y), ctx.playerID)))
      });
    }

    return _freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__["INVALID_MOVE"];
  } else {
    changed.sort(function (a, b) {
      return b - a;
    });
    return Object.assign({}, G, {
      points: G.points.map(function (point, i) {
        if (changed.length > 0 && i === changed[changed.length - 1]) {
          changed.pop();
          return ctx.playerID;
        } else {
          return point;
        }
      })
    });
  }
}
function getScoreBoard(G, ctx) {
  var scoreBoard = new Array(ctx.numPlayers).fill(0);
  G.points.filter(function (point) {
    return point !== null && parseInt(point) < ctx.numPlayers;
  }).forEach(function (point) {
    return scoreBoard[point]++;
  });
  return scoreBoard.map(function (score, i) {
    return {
      playerID: i.toString(),
      score: score
    };
  }).sort(function (a, b) {
    return b.score - a.score;
  });
}
var GameConfig = {
  name: 'reversi',
  flow: {
    movesPerTurn: 1,
    endGameIf: function endGameIf(G, ctx) {
      if (!G.points.some(function (point) {
        return point === null;
      })) {
        return {
          scoreboard: getScoreBoard(G, ctx)
        };
      }
    }
  },
  moves: {
    placePiece: placePiece
  },
  setup: function setup(ctx) {
    var points = Array(64).fill(null);

    if (ctx.numPlayers === 2) {
      points[toPosition(4, 4)] = '1';
      points[toPosition(4, 3)] = '2';
    } else {
      points[toPosition(4, 3)] = '1';
      points[toPosition(4, 4)] = '2';
    }

    points[toPosition(3, 3)] = '0';
    points[toPosition(3, 4)] = '3';
    return {
      points: points
    };
  }
};
var ReversiGame = Object(_freeboardgame_org_boardgame_io_core__WEBPACK_IMPORTED_MODULE_0__["Game"])(GameConfig);

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZXMvcmV2ZXJzaS9nYW1lLnRzIl0sIm5hbWVzIjpbInRvUG9zaXRpb24iLCJ4IiwieSIsImluQm91bmRzIiwiZ2V0VmFsaWRNb3ZlcyIsIkciLCJwbGF5ZXJJRCIsInZhbGlkTW92ZXMiLCJTZXQiLCJwb2ludHMiLCJtYXAiLCJwbGF5ZXIiLCJwb3NpdGlvbiIsImZpbHRlciIsInBvaW50IiwiZm9yRWFjaCIsImkiLCJqIiwiTWF0aCIsImZsb29yIiwiY3VyclgiLCJjdXJyWSIsImsiLCJlbmQiLCJhZGQiLCJzaXplIiwicGxhY2VQaWVjZSIsImN0eCIsIklOVkFMSURfTU9WRSIsImNoYW5nZWQiLCJ2YWxpZCIsInVwZGF0ZSIsImN1cnJlbnRQbGF5ZXIiLCJwdXNoIiwibGVuZ3RoIiwiaGFzIiwiT2JqZWN0IiwiYXNzaWduIiwidmFsdWVzIiwic29ydCIsImEiLCJiIiwicG9wIiwiZ2V0U2NvcmVCb2FyZCIsInNjb3JlQm9hcmQiLCJBcnJheSIsIm51bVBsYXllcnMiLCJmaWxsIiwicGFyc2VJbnQiLCJzY29yZSIsInRvU3RyaW5nIiwiR2FtZUNvbmZpZyIsIm5hbWUiLCJmbG93IiwibW92ZXNQZXJUdXJuIiwiZW5kR2FtZUlmIiwic29tZSIsInNjb3JlYm9hcmQiLCJtb3ZlcyIsInNldHVwIiwiUmV2ZXJzaUdhbWUiLCJHYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0EsU0FBU0EsVUFBVCxDQUFvQkMsQ0FBcEIsRUFBdUJDLENBQXZCLEVBQTBCO0FBQ3RCLFNBQU9BLENBQUMsR0FBRyxDQUFKLEdBQVFELENBQWY7QUFDSDs7QUFDRCxTQUFTRSxRQUFULENBQWtCRixDQUFsQixFQUFxQkMsQ0FBckIsRUFBd0I7QUFDcEIsU0FBT0QsQ0FBQyxJQUFJLENBQUwsSUFBVUEsQ0FBQyxHQUFHLENBQWQsSUFBbUJDLENBQUMsSUFBSSxDQUF4QixJQUE2QkEsQ0FBQyxHQUFHLENBQXhDO0FB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R0FBR29DLEtBQUssQ0FBQyxFQUFELENBQUwsQ0FBVUUsSUFBVixDQUFlLElBQWYsQ0FBYjs7QUFDQSxRQUFJcEIsR0FBRyxDQUFDbUIsVUFBSixLQUFtQixDQUF2QixFQUEwQjtBQUN0QnJDLFlBQU0sQ0FBQ1QsVUFBVSxDQUFDLENBQUQsRUFBSSxDQUFKLENBQVgsQ0FBTixHQUEyQixHQUEzQjtBQUNBUyxZQUFNLENBQUNULFVBQVUsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFYLENBQU4sR0FBMkIsR0FBM0I7QUFDSCxLQUhELE1BSUs7QUFDRFMsWUFBTSxDQUFDVCxVQUFVLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBWCxDQUFOLEdBQTJCLEdBQTNCO0FBQ0FTLFlBQU0sQ0FBQ1QsVUFBVSxDQUFDLENBQUQsRUFBSSxDQUFKLENBQVgsQ0FBTixHQUEyQixHQUEzQjtBQUNIOztBQUNEUyxVQUFNLENBQUNULFVBQVUsQ0FBQyxDQUFELEVBQUksQ0FBSixDQUFYLENBQU4sR0FBMkIsR0FBM0I7QUFDQVMsVUFBTSxDQUFDVCxVQUFVLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBWCxDQUFOLEdBQTJCLEdBQTNCO0FBQ0EsV0FBTztBQUNIUyxZQUFNLEVBQU5BO0FBREcsS0FBUDtBQUdIO0FBNUJjLENBQW5CO0FBOEJPLElBQU1tRCxXQUFXLEdBQUdDLGlGQUFJLENBQUNWLFVBQUQsQ0FBeEIsQyIsImZpbGUiOiIwNGJmY2UxODBhYmNhOTU5NmQ2Ny5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdhbWUsIElOVkFMSURfTU9WRSB9IGZyb20gJ0BmcmVlYm9hcmRnYW1lLm9yZy9ib2FyZGdhbWUuaW8vY29yZSc7XG5mdW5jdGlvbiB0b1Bvc2l0aW9uKHgsIHkpIHtcbiAgICByZXR1cm4geSAqIDggKyB4O1xufVxuZnVuY3Rpb24gaW5Cb3VuZHMoeCwgeSkge1xuICAgIHJldHVybiB4ID49IDAgJiYgeCA8IDggJiYgeSA+PSAwICYmIHkgPCA4O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGdldFZhbGlkTW92ZXMoRywgcGxheWVySUQpIHtcbiAgICBsZXQgdmFsaWRNb3ZlcyA9IG5ldyBTZXQoKTtcbiAgICBHLnBvaW50c1xuICAgICAgICAubWFwKChwbGF5ZXIsIHBvc2l0aW9uKSA9PiAoeyBwbGF5ZXIsIHBvc2l0aW9uIH0pKVxuICAgICAgICAuZmlsdGVyKHBvaW50ID0+IHBvaW50LnBsYXllciA9PT0gcGxheWVySUQpXG4gICAgICAgIC5mb3JFYWNoKHBvaW50ID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IC0xOyBpIDw9IDE7IGkrKykge1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IC0xOyBqIDw9IDE7IGorKykge1xuICAgICAgICAgICAgICAgIGlmIChpID09PSAwICYmIGogPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBwb2ludC5wb3NpdGlvbiAlIDg7XG4gICAgICAgICAgICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IocG9pbnQucG9zaXRpb24gLyA4KTtcbiAgICAgICAgICAgICAgICBsZXQgY3VyclggPSB4ICsgaTtcbiAgICAgICAgICAgICAgICBsZXQgY3VyclkgPSB5ICsgajtcbiAgICAgICAgICAgICAgICBsZXQgayA9IDE7XG4gICAgICAgICAgICAgICAgbGV0IGVuZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGluQm91bmRzKGN1cnJYLCBjdXJyWSkgJiYgRy5wb2ludHNbdG9Qb3NpdGlvbihjdXJyWCwgY3VyclkpXSAhPT0gcGxheWVySUQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSB0b1Bvc2l0aW9uKGN1cnJYLCBjdXJyWSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChHLnBvaW50c1twb3NpdGlvbl0gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCA9IHBvc2l0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaysrO1xuICAgICAgICAgICAgICAgICAgICBjdXJyWCA9IHggKyBpICogaztcbiAgICAgICAgICAgICAgICAgICAgY3VyclkgPSB5ICsgaiAqIGs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbmQgIT09IG51bGwgJiYgayA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRNb3Zlcy5hZGQoZW5kKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAodmFsaWRNb3Zlcy5zaXplID4gMCkge1xuICAgICAgICByZXR1cm4gdmFsaWRNb3ZlcztcbiAgICB9XG4gICAgRy5wb2ludHNcbiAgICAgICAgLm1hcCgocGxheWVyLCBwb3NpdGlvbikgPT4gKHsgcGxheWVyLCBwb3NpdGlvbiB9KSlcbiAgICAgICAgLmZpbHRlcihwb2ludCA9PiBwb2ludC5wbGF5ZXIgPT09IG51bGwpXG4gICAgICAgIC5mb3JFYWNoKHBvaW50ID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IC0xOyBpIDw9IDE7IGkrKykge1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IC0xOyBqIDw9IDE7IGorKykge1xuICAgICAgICAgICAgICAgIGlmIChpID09PSAwICYmIGogPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHggPSBwb2ludC5wb3NpdGlvbiAlIDg7XG4gICAgICAgICAgICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IocG9pbnQucG9zaXRpb24gLyA4KTtcbiAgICAgICAgICAgICAgICBpZiAoaW5Cb3VuZHMoeCArIGksIHkgKyBqKSAmJiBHLnBvaW50c1t0b1Bvc2l0aW9uKHggKyBpLCB5ICsgaildICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbGlkTW92ZXMuYWRkKHBvaW50LnBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gdmFsaWRNb3Zlcztcbn1cbmV4cG9ydCBmdW5jdGlvbiBwbGFjZVBpZWNlKEcsIGN0eCwgeCwgeSkge1xuICAgIGlmIChHLnBvaW50c1t0b1Bvc2l0aW9uKHgsIHkpXSAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gSU5WQUxJRF9NT1ZFO1xuICAgIH1cbiAgICBsZXQgY2hhbmdlZCA9IFt0b1Bvc2l0aW9uKHgsIHkpXTsgLy8gQ2hhbmdlZCBwb3NpdGlvbnNcbiAgICBmb3IgKGxldCBpID0gLTE7IGkgPD0gMTsgaSsrKSB7XG4gICAgICAgIGZvciAobGV0IGogPSAtMTsgaiA8PSAxOyBqKyspIHtcbiAgICAgICAgICAgIGlmIChpID09PSAwICYmIGogPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCB2YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IHVwZGF0ZSA9IFtdO1xuICAgICAgICAgICAgbGV0IGN1cnJYID0geCArIGk7XG4gICAgICAgICAgICBsZXQgY3VyclkgPSB5ICsgajtcbiAgICAgICAgICAgIGZvciAobGV0IGsgPSAyOyBpbkJvdW5kcyhjdXJyWCwgY3VyclkpICYmIEcucG9pbnRzW3RvUG9zaXRpb24oY3VyclgsIGN1cnJZKV0gIT09IG51bGw7IGsrKykge1xuICAgICAgICAgICAgICAgIGlmIChHLnBvaW50c1t0b1Bvc2l0aW9uKGN1cnJYLCBjdXJyWSldID09PSBjdHguY3VycmVudFBsYXllcikge1xuICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cGRhdGUucHVzaCh0b1Bvc2l0aW9uKGN1cnJYLCBjdXJyWSkpO1xuICAgICAgICAgICAgICAgIGN1cnJYID0geCArIGkgKiBrO1xuICAgICAgICAgICAgICAgIGN1cnJZID0geSArIGogKiBrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgY2hhbmdlZC5wdXNoKC4uLnVwZGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNoYW5nZWQubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGlmIChnZXRWYWxpZE1vdmVzKEcsIGN0eC5wbGF5ZXJJRCkuaGFzKHRvUG9zaXRpb24oeCwgeSkpKSB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgRywgeyBwb2ludHM6IE9iamVjdC52YWx1ZXMoT2JqZWN0LmFzc2lnbih7fSwgRy5wb2ludHMsIHsgW3RvUG9zaXRpb24oeCwgeSldOiBjdHgucGxheWVySUQgfSkpIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBJTlZBTElEX01PVkU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjaGFuZ2VkLnNvcnQoKGEsIGIpID0+IGIgLSBhKTtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIEcsIHsgcG9pbnRzOiBHLnBvaW50cy5tYXAoKHBvaW50LCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNoYW5nZWQubGVuZ3RoID4gMCAmJiBpID09PSBjaGFuZ2VkW2NoYW5nZWQubGVuZ3RoIC0gMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlZC5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0eC5wbGF5ZXJJRDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2ludDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSB9KTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0U2NvcmVCb2FyZChHLCBjdHgpIHtcbiAgICBsZXQgc2NvcmVCb2FyZCA9IG5ldyBBcnJheShjdHgubnVtUGxheWVycykuZmlsbCgwKTtcbiAgICBHLnBvaW50c1xuICAgICAgICAuZmlsdGVyKHBvaW50ID0+IHBvaW50ICE9PSBudWxsICYmIHBhcnNlSW50KHBvaW50KSA8IGN0eC5udW1QbGF5ZXJzKVxuICAgICAgICAuZm9yRWFjaChwb2ludCA9PiBzY29yZUJvYXJkW3BvaW50XSsrKTtcbiAgICByZXR1cm4gc2NvcmVCb2FyZC5tYXAoKHNjb3JlLCBpKSA9PiAoeyBwbGF5ZXJJRDogaS50b1N0cmluZygpLCBzY29yZSB9KSkuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xufVxuY29uc3QgR2FtZUNvbmZpZyA9IHtcbiAgICBuYW1lOiAncmV2ZXJzaScsXG4gICAgZmxvdzoge1xuICAgICAgICBtb3Zlc1BlclR1cm46IDEsXG4gICAgICAgIGVuZEdhbWVJZjogKEcsIGN0eCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFHLnBvaW50cy5zb21lKHBvaW50ID0+IHBvaW50ID09PSBudWxsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHNjb3JlYm9hcmQ6IGdldFNjb3JlQm9hcmQoRywgY3R4KSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgIH0sXG4gICAgbW92ZXM6IHtcbiAgICAgICAgcGxhY2VQaWVjZSxcbiAgICB9LFxuICAgIHNldHVwOiAoY3R4KSA9PiB7XG4gICAgICAgIGxldCBwb2ludHMgPSBBcnJheSg2NCkuZmlsbChudWxsKTtcbiAgICAgICAgaWYgKGN0eC5udW1QbGF5ZXJzID09PSAyKSB7XG4gICAgICAgICAgICBwb2ludHNbdG9Qb3NpdGlvbig0LCA0KV0gPSAnMSc7XG4gICAgICAgICAgICBwb2ludHNbdG9Qb3NpdGlvbig0LCAzKV0gPSAnMic7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwb2ludHNbdG9Qb3NpdGlvbig0LCAzKV0gPSAnMSc7XG4gICAgICAgICAgICBwb2ludHNbdG9Qb3NpdGlvbig0LCA0KV0gPSAnMic7XG4gICAgICAgIH1cbiAgICAgICAgcG9pbnRzW3RvUG9zaXRpb24oMywgMyldID0gJzAnO1xuICAgICAgICBwb2ludHNbdG9Qb3NpdGlvbigzLCA0KV0gPSAnMyc7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwb2ludHMsXG4gICAgICAgIH07XG4gICAgfSxcbn07XG5leHBvcnQgY29uc3QgUmV2ZXJzaUdhbWUgPSBHYW1lKEdhbWVDb25maWcpO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==